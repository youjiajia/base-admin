(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["bill"],{"13c9":function(e,t,n){"use strict";var a=n("8fab"),r=n.n(a);r.a},"13ca":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard__container"},[n("el-row",[n("el-col",{attrs:{span:24}},[n("el-form",{ref:"queryForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.query,rules:e.formRules}},[n("el-form-item",{attrs:{label:"年",prop:"year"}},[n("el-input",{attrs:{placeholder:"年",disabled:!e.isAdmin},model:{value:e.query.year,callback:function(t){e.$set(e.query,"year",t)},expression:"query.year"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"月"}},[n("el-select",{attrs:{placeholder:"月",disabled:!e.isAdmin},model:{value:e.query.month,callback:function(t){e.$set(e.query,"month",t)},expression:"query.month"}},e._l(e.MonthOptions,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleExport(!0,void 0)}}},[e._v("导出")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleExport(void 0,void 0)}}},[e._v("导出(无PV)")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleShowConfig}},[e._v("配置")])],1)],1)],1),e._v(" "),n("el-col",{attrs:{span:24}},[n("el-table",{staticClass:"roboto-font",staticStyle:{width:"100%"},attrs:{data:e.billDetail,"show-summary":""}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[n("DetailTable",{attrs:{"table-data":t.items}})]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"cp_name",label:"CP Name",width:"180"}}),e._v(" "),n("el-table-column",{attrs:{prop:"pv",label:"PV",width:"180",align:"right"}}),e._v(" "),n("el-table-column",{attrs:{prop:"gain",label:"收入",width:"180",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.gain.toFixed(2)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"earn",label:"分成",width:"180",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.earn.toFixed(2)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"base_revision",label:"保底修正",width:"180",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.base_revision.toFixed(2)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleExport(!0,!0,a.cp_code)}}},[e._v("导出")]),e._v(" "),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleExport(void 0,!0,a.cp_code)}}},[e._v("导出(无PV)")])]}}])})],1)],1)],1),e._v(" "),n("el-drawer",{staticClass:"scroll-drawer",attrs:{title:"编辑配置",size:"640",visible:e.showConfig,direction:"rtl","show-close":!1},on:{"update:visible":function(t){e.showConfig=t}},scopedSlots:e._u([{key:"title",fn:function(){return[n("el-button",{attrs:{type:"primary",disabled:!e.configChanged},on:{click:e.doQuery}},[e._v("保存配置并查询")])]},proxy:!0}])},[e._v(" "),n("el-form",{ref:"configForm",attrs:{model:e.billConfig,"label-width":"80px",disabled:!e.isAdmin}},[n("el-form-item",{attrs:{label:"总计"}},[n("el-input-number",{staticStyle:{width:"454px"},attrs:{precision:2,step:1e3,min:0},model:{value:e.billConfig.total,callback:function(t){e.$set(e.billConfig,"total",t)},expression:"billConfig.total"}})],1)],1),e._v(" "),e._l(e.billConfig.items,(function(t){return n("el-form",{key:t.cp_name,ref:"configItemsForm",refInFor:!0,attrs:{model:e.billConfig,inline:!0,"label-width":"80px",disabled:!e.isAdmin}},[n("el-form-item",{attrs:{label:t.cp_name||"匿名"}},[n("el-input-number",{attrs:{min:0,max:1,step:.01},model:{value:t.percentage,callback:function(n){e.$set(t,"percentage",n)},expression:"line.percentage"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"保底"}},[n("el-input-number",{attrs:{precision:2,step:1e3,min:0},model:{value:t.base,callback:function(n){e.$set(t,"base",n)},expression:"line.base"}})],1)],1)}))],2)],1)},r=[],i=(n("ac6a"),n("96cf"),n("3b8d")),l=n("d225"),o=n("b0b4"),s=n("308d"),c=n("6bb5"),u=n("4e2b"),p=n("768b"),f=(n("f576"),n("5df3"),n("1c4c"),n("9ab4")),d=n("b32d");function b(e){return d["a"].post("/api/bill_detail",e)}function h(e){return d["a"].post("/api/config_detail ",e)}function g(e){return d["a"].post("/api/config_update",e)}function m(e){window.open(e)}var v="/api/bill_export",y=n("60a3"),_=n("9dba"),k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"detail-table__container"},[n("div",[n("el-input",{attrs:{placeholder:"书名"},model:{value:e.bookname,callback:function(t){e.bookname=t},expression:"bookname"}})],1),e._v(" "),n("el-table",{staticClass:"roboto-font",staticStyle:{width:"100%"},attrs:{data:e.pagedTableData}},[n("el-table-column",{attrs:{prop:"name",label:"书名"}}),e._v(" "),n("el-table-column",{attrs:{prop:"pv",label:"PV",align:"right",width:"180"}}),e._v(" "),n("el-table-column",{attrs:{prop:"earn",label:"分成",align:"right",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(a.earn.toFixed(2)))])]}}])})],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-pagination",{attrs:{layout:"prev, pager, next",total:e.filtedTableData.length,"page-size":e.pagenation.pageSize,"current-page":e.pagenation.currentPage,"pager-count":e.pagenation.pagerCount},on:{"update:currentPage":function(t){return e.$set(e.pagenation,"currentPage",t)},"update:current-page":function(t){return e.$set(e.pagenation,"currentPage",t)}}})],1)],1)},w=[],C=(n("7f7f"),n("6762"),n("2fdb"),function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(s["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.bookname="",e.pagenation={pageSize:10,currentPage:1,pagerCount:9},e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"filtedTableData",get:function(){var e=this.bookname.trim().toLowerCase();return e?this.tableData.filter((function(t){return t.name.toLowerCase().includes(e)})):this.tableData}},{key:"pagedTableData",get:function(){var e=Math.ceil(this.filtedTableData.length/this.pagenation.pageSize),t=this.pagenation.currentPage<=e?this.pagenation.currentPage:e,n=this.pagenation.pageSize*(t-1);return this.filtedTableData.slice(n,n+this.pagenation.pageSize)}}]),t}(y["e"]));Object(f["a"])([Object(y["b"])({default:function(){return[]}})],C.prototype,"tableData",void 0),C=Object(f["a"])([Object(y["a"])({name:"CompDetailTable"})],C);var x=C,O=x,j=(n("93f3"),n("2877")),D=Object(j["a"])(O,k,w,!1,null,"b3d3789e",null),S=D.exports,B=n("0644"),q=n.n(B),F=Array.from({length:12}).map((function(e,t){return"".concat(t+1).padStart(2,"0")})),R=function(){var e=(new Date).getMonth(),t=(new Date).getFullYear();return e="".concat(0===e?12:e).padStart(2,"0"),t="".concat("12"===e?t-1:t),[t,e]}(),P=Object(p["a"])(R,2),$=P[0],T=P[1],z=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(s["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.loading=!1,e.configChanged=!1,e.dataInited=!1,e.showConfig=!1,e.billDetail=[],e.billConfig={total:0,items:[]},e.billConfigBak={total:0,items:[]},e.query={year:$,month:T},e.MonthOptions=F,e.formRules={year:[{validator:e.validateYear,trigger:"blur"}]},e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"validateYear",value:function(e,t,n){/^(202|203)[0-9]$/.test(t)?n():n(new Error("请填写正确的年份,2020~2039"))}},{key:"created",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.loading=!0,e.next=4,Promise.all([this.fetchBillDetail(),this.fetchBillConfig()]);case 4:this.dataInited=!0,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error(e.t0);case 10:return e.prev=10,this.loading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,7,10,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleBillConifgChange",value:function(){this.dataInited&&(this.configChanged=!0)}},{key:"handleQueryChange",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.billConfig=q()(this.billConfigBak),e.next=3,this.$nextTick();case 3:return this.configChanged=!1,e.next=6,this.$nextTick();case 6:this.doQuery();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleShowConfig",value:function(){this.showConfig=!0}},{key:"fetchBillDetail",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b({bill_date:this.billDate,novel:!0});case 3:this.billDetail=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"fetchBillConfig",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h({bill_date:this.billDate});case 3:this.billConfigBak=e.sent,this.billConfigBak=this.billConfigBak||{total:0,items:[]},this.billConfig=q()(this.billConfigBak),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateBillConfig",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g(this.billConfig);case 3:this.configChanged=!1,e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"doQuery",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.showConfig=!1,this.loading=!0,e.next=5,this.queryForm.validate();case 5:if(!this.configChanged){e.next=10;break}return e.next=8,this.updateBillConfig();case 8:e.next=12;break;case 10:return e.next=12,this.fetchBillConfig();case 12:return e.next=14,this.fetchBillDetail();case 14:e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](0),console.error(e.t0);case 19:return e.prev=19,this.loading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[0,16,19,22]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleExport",value:function(e,t,n){var a=this.$router.resolve({path:v,query:{bill_date:this.billDate,pv:e,is_novel:t,provider:n}}).href;m(a)}},{key:"billDate",get:function(){return"".concat(this.query.year).concat(this.query.month)}},{key:"isAdmin",get:function(){return _["a"].isAdmin}}]),t}(y["e"]);Object(f["a"])([Object(y["d"])("queryForm")],z.prototype,"queryForm",void 0),Object(f["a"])([Object(y["d"])("configForm")],z.prototype,"configForm",void 0),Object(f["a"])([Object(y["f"])("billConfig",{deep:!0})],z.prototype,"handleBillConifgChange",null),Object(f["a"])([Object(y["f"])("query",{deep:!0})],z.prototype,"handleQueryChange",null),z=Object(f["a"])([Object(y["a"])({name:"Bill",components:{DetailTable:S}})],z);var E=z,A=E,I=(n("13c9"),Object(j["a"])(A,a,r,!1,null,"050c116d",null));t["default"]=I.exports},7977:function(e,t,n){},"8fab":function(e,t,n){},"93f3":function(e,t,n){"use strict";var a=n("7977"),r=n.n(a);r.a}}]);