(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{2017:function(t,e,o){"use strict";var r=o("25ae"),a=o.n(r);a.a},"25ae":function(t,e,o){t.exports={menuBg:"#304156",menuText:"#bfcbd9",menuActiveText:"#409eff"}},"2c3b":function(t,e,o){"use strict";var r=o("6b01"),a=o.n(r);a.a},"6b01":function(t,e,o){},"9ed6":function(t,e,o){"use strict";o.r(e);var r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"login-container"},[o("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:t.loginForm,rules:t.loginRules,autocomplete:"on","label-position":"left"}},[o("div",{staticClass:"title-container"},[o("h3",{staticClass:"title"},[t._v("小说分成对账系统")])]),t._v(" "),t.hideLoginForm?t._e():[o("div",{staticStyle:{position:"relative","margin-bottom":"16px"}},[o("div",{staticClass:"tips"},[o("span",[t._v("首次登录请点击飞书登录，注意选择正确的飞书主体")])])]),t._v(" "),o("el-form-item",{attrs:{prop:"email"}},[o("span",{staticClass:"svg-container"},[o("svg-icon",{attrs:{name:"user"}})],1),t._v(" "),o("el-input",{ref:"email",attrs:{name:"email",type:"text",autocomplete:"on",placeholder:"email"},model:{value:t.loginForm.email,callback:function(e){t.$set(t.loginForm,"email",e)},expression:"loginForm.email"}})],1),t._v(" "),o("el-form-item",{attrs:{prop:"password"}},[o("span",{staticClass:"svg-container"},[o("svg-icon",{attrs:{name:"password"}})],1),t._v(" "),o("el-input",{key:t.passwordType,ref:"password",attrs:{type:t.passwordType,placeholder:"password",name:"password",autocomplete:"on"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleLogin(e)}},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}}),t._v(" "),o("span",{staticClass:"show-pwd",on:{click:t.showPwd}},[o("svg-icon",{attrs:{name:"password"===t.passwordType?"eye-off":"eye-on"}})],1)],1),t._v(" "),o("el-button",{staticStyle:{width:"100%","margin-bottom":"30px"},attrs:{loading:t.loading,type:"primary"},nativeOn:{click:function(e){return e.preventDefault(),t.handleLogin(e)}}},[t._v("登录")])],t._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-button",{staticStyle:{width:"100%","margin-bottom":"30px"},attrs:{type:"text"},nativeOn:{click:function(e){return e.preventDefault(),t.gotoThirdPartLogin("webeye")}}},[t._v("正式员工飞书登录")])],1),t._v(" "),o("el-col",{attrs:{span:12}},[o("el-button",{staticStyle:{width:"100%","margin-bottom":"30px"},attrs:{type:"text"},nativeOn:{click:function(e){return e.preventDefault(),t.gotoThirdPartLogin("outer")}}},[t._v("外部员工飞书登录")])],1)],1)],2)],1)},a=[],n=(o("96cf"),o("3b8d")),i=o("d225"),s=o("b0b4"),c=o("308d"),l=o("6bb5"),p=o("4e2b"),u=o("9ab4"),d=o("60a3"),g=o("5581");function h(){var t=navigator.userAgent;return/Lark/.test(t)}var m=o("b8f0"),f=o("2593"),v=o.n(f),b=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.validatePassword=function(t,e,o){e.length<6?o(new Error("The password can not be less than 6 digits")):o()},t.loginRules={password:[{validator:t.validatePassword,trigger:"blur"}]},t.passwordType="password",t.loading=!1,t.needLogin=!1,t.larkAppid={webeye:"cli_9ed5d5bde42a900e",outer:"cli_9e1d009dd4e9d00d"},t.platformAppid="498af4fd-f94e-4beb-9176-08b9d390bb21",t.loginBaseUrl="https://open.feishu.cn/connect/qrconnect/page/sso/",t.platformUrl="http://lark.geezcomics.com/lark/lark_login",t.loginType="lark",t.hideLoginForm=!1,t.loginForm={email:"",password:"",appId:t.platformAppid},t}return Object(p["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){this.needLogin=!1,Object(g["c"])()?this.gotoNextPage():(this.from&&localStorage.setItem("$_login_from",this.from),this.code?this.thirdPartLogin():Object(g["a"])("sessionid")||this.code||!h()?this.needLogin=!0:this.hideLoginForm=!0)}},{key:"mounted",value:function(){""===this.loginForm.email?this.$refs.email.focus():""===this.loginForm.password&&this.$refs.password.focus()}},{key:"showPwd",value:function(){var t=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){t.$refs.password.focus()}))}},{key:"handleLogin",value:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.loginForm.validate();case 3:if(e=t.sent,!e){t.next=12;break}return this.loading=!0,t.next=8,Object(m["c"])(this.loginForm);case 8:this.loading=!1,this.gotoNextPage(),t.next=13;break;case 12:return t.abrupt("return",!1);case 13:t.next=20;break;case 15:t.prev=15,t.t0=t["catch"](0),this.loading=!1,console.error(t.t0),this.$message.error(t.t0.message);case 20:case"end":return t.stop()}}),t,this,[[0,15]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"gotoNextPage",value:function(){var t=localStorage.getItem("$_login_from");localStorage.removeItem("$_login_from"),t=this.from||t||"",t?this.$router.push({path:t}):this.$router.push({path:"/"})}},{key:"gotoThirdPartLogin",value:function(t){window.location.href=this.goto[t]}},{key:"thirdPartLogin",value:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(m["e"])({code:this.code},this.type);case 3:e=t.sent,this.$store.commit("SET_USER_INFO",v()(e,["_id","department","email","avatar","name","token","roles","webeye"])),this.gotoNextPage(),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),this.$message.error(t.t0);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"state",get:function(){var t="production";return{webeye:"webeye|".concat(this.platformAppid,"|").concat(t),outer:"jxhz|".concat(this.platformAppid,"|").concat(t)}}},{key:"goto",get:function(){return{webeye:"".concat(this.loginBaseUrl,"?app_id=").concat(this.larkAppid.webeye,"&state=").concat(this.state.webeye,"&redirect_uri=").concat(this.platformUrl),outer:"".concat(this.loginBaseUrl,"?app_id=").concat(this.larkAppid.outer,"&state=").concat(this.state.outer,"&redirect_uri=").concat(this.platformUrl)}}},{key:"from",get:function(){return this.$route.query.from}},{key:"code",get:function(){return this.$route.query.code}}]),e}(d["e"]);b=Object(u["a"])([Object(d["a"])({name:"Login"})],b);var w=b,y=w,k=(o("2017"),o("2c3b"),o("2877")),_=Object(k["a"])(y,r,a,!1,null,"5a6bfff9",null);e["default"]=_.exports}}]);